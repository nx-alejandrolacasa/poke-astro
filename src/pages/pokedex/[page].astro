---
export const prerender = true

import { Pagination } from '@components/Pagination'
import { PokemonTile } from '@components/PokemonTile'
import Layout from '@layouts/Layout.astro'
import { fetchPokemonCount, fetchPokemonPage } from '@utils/pokemon'
import type { Pokemon } from '@utils/pokemon'

export async function getStaticPaths() {
  const PAGE_SIZE = 24

  // Only fetch the count, not all Pokémon data
  const totalPokemon = await fetchPokemonCount()
  const totalPages = Math.ceil(totalPokemon / PAGE_SIZE)

  // Generate paths for all pages
  const paths = []
  for (let i = 1; i <= totalPages; i++) {
    paths.push({
      params: { page: String(i) },
      props: {
        pageNumber: i,
        totalPokemon,
        totalPages,
        pageSize: PAGE_SIZE,
      },
    })
  }

  return paths
}

type PageProps = {
  pageNumber: number
  totalPokemon: number
  totalPages: number
  pageSize: number
}

const { pageNumber, totalPokemon, pageSize } = Astro.props as PageProps

// Fetch only the Pokémon for this specific page
const pokemonPage = await fetchPokemonPage(pageNumber, pageSize)
---

<Layout title="Pokémon Astro - Pokédex">
  <ul class="grid gap-4 grid-cols-2 md:grid-cols-3">
    {
      pokemonPage.results.map((pokemon) => (
        <li class="list-none">
          <PokemonTile pokemon={pokemon} />
        </li>
      ))
    }
  </ul>

  <Pagination client:only="react" count={totalPokemon} page={pageNumber} />
</Layout>
